<!--pages/tv_sale/system.wxml-->
<import src="/pages/template/commons" />

<!-- 有机顶盒 -->
<scroll-view wx:if="{{hotel_has_room}}" class="container theme-main" style="height:calc(100vh - {{28 + SystemInfo.statusBarHeight}}px);" scroll-y="true" scroll-with-animation="true">

  <!-- 正在播放的活动面板 -->
  <view class='playing-sale-panel full_width'>
    <view class='row theme7' wx:for="{{play_list}}" wx:for-item="bean" wx:key="key" wx:index="index">
      <view class='title theme-font3'>{{index==0?'循环播放活动':''}}</view>
      <view class='dividing-line'></view>
      <view class='ads'>
        <image src='{{bean.img_url}}'></image>
        <view class='goods'>
          <view class='title'>{{bean.name}}</view>
          <view class='infomation theme-font2'>
            <view class='price'>￥ {{bean.price}}元</view>
            <view class='block'></view>
            <view class='discount theme-font5'>返利 {{bean.rebate_integral}}积分</view>
          </view>
        </view>
        <button bindtap="delProgramPlay" data-goods_id="{{bean.goods_id}}" data-key="{{key}}" data-play_list="{{play_list}}">移除</button>
      </view>
    </view>

  </view>

  <!-- 活动促销面板 -->
  <view class='sale-panel full_width'>
    <view class='tab-bar theme7'>
      <view bindtap="selectXxk" data-status="1" class='tab-title{{showPageType == 1 ? " selected" : ""}}'>活动促销</view>
      <view class='dividing-line'></view>
      <view bindtap="selectXxk" data-status="2" class='tab-title{{showPageType == 2 || showPageType == 3 ? " selected" : ""}}'>餐厅活动</view>
    </view>

    <!-- 活动促销 -->
    <block wx:if="{{showPageType == 1}}">
      <block wx:if="{{sale_list.length > 0}}">
        <view class="row full_width theme7 {{bean.isTouchMove ? 'touch-move-active' : 'touch-move-unactive'}}" wx:for="{{sale_list}}" wx:for-item="bean" wx:key="key" data-index="{{index}}" bindtouchstart="touchstart" bindtouchmove="touchmove">
          <view class='content' data-index="{{index}}">
            <view class="pic">
              <image src='{{bean.img_url}}'></image>
            </view>
            <view class='goods'>
              <view class='title full_width theme-font2'>{{bean.goods_name}}</view>
              <view class='infomation full_width'>
                <view class='price theme-font2'>￥ {{bean.price}}元</view>
                <!-- <view class='discount theme-font5'>返利 {{bean.rebate_integral}}积分</view> -->
              </view>
              <view class='operate'>
                <button class='btn-menu' bindtap="programPlay" data-goods_id="{{bean.goods_id}}">电视轮播</button>
                <button class='btn-tv' bindtap="boxShow" data-goods_id="{{bean.goods_id}}" data-oss_addr="{{bean.oss_addr}}" data-qrcode_url="{{bean.qrcode_url}}">大屏展示</button>
                <button class='share' bindtap="pop_share" data-goods_info="{{bean}}">分享</button>
              </view>
            </view>
          </view>
          <view class="del theme-button-add" catchtap="del" data-index="{{index}}" data-goods_id="{{bean.goods_id}}">删除</view>
        </view>
      </block>
      <block wx:else>
        <view class="no-data full_width theme7" style="height:800rpx;">
          <view>您还没有选择要推广的活动</view>
          <view>请前往【我的——活动促销商品管理】选择</view>
          <view>
            <navigator class="theme-button-add" url="/pages/mine/pop_list">添加</navigator>
          </view>
        </view>
      </block>
    </block>

    <!-- 我的活动[添加] -->
    <block wx:if="{{showPageType == 2 && is_my_activity==0}}">
      <view class='ads-add theme7'>
        <form bindsubmit="pubAct">
          <view class='btn-add full_width'>
            <block wx:if="{{my_activity_info.media_type == 0}}">
              <image src='/images/icon/999999_upload.png'></image>
              <view>
                <view class='theme-font' bindtap="chooseImg">上传图片</view>
                <view class='theme-font' bindtap="chooseVideo">上传视频</view>
              </view>
            </block>
            <block wx:if="{{my_activity_info.media_type == 2}}">
              <view class='clear theme-font' bindtap="clearGoodsImg" data-resource_type="2">重选</view>
              <image class="choosed-pic" src='{{filename}}'></image>
            </block>
            <block wx:if="{{my_activity_info.media_type == 1}}">
              <view class='clear theme-font' bindtap="clearGoodsImg" data-resource_type="1">重选</view>
              <video class="choosed-video" src="{{filename}}"></video>
            </block>
          </view>
          <view class='row full_width'>
            <label>商品名称</label>
            <input name='goods_name' type="text" placeholder='请输入商品名称  ' placeholder-style='text-align: right;' focus="{{goods_name_focus}}" maxlength="30" value="{{goods_name}}"></input>
          </view>
          <view class='row full_width'>
            <label>输入价格</label>
            <input name='price' type="digit" placeholder='最高9999元  ' placeholder-style='text-align: right;' focus="{{price_focus}}" bindinput='setMaxPrice' value="{{price}}"></input>
          </view>
          <view class='row full_width' style="width: 550rpx;">
            <label>活动时间</label>
            <view>
              <picker mode='date' bindchange="bindDateChange" start="2019-01-01" end="2022-12-31" data-date_type="1">
                <label>{{my_activity_info.start_time}}</label>
                <image src='/images/icon/999999_calendar.png'></image>
              </picker>
              <label>~</label>
              <picker mode='date' bindchange="bindDateChange" start="2019-01-01" end="2022-12-31" data-date_type="2">
                <label>{{my_activity_info.end_time}}</label>
                <image src='/images/icon/999999_calendar.png'></image>
              </picker>
            </view>
          </view>
          <view class='row full_width'>
            <label>活动范围</label>
            <radio-group bindchange="radioChange">
              <radio bindtap="changeRoomType" wx:for="{{room_arr}}" wx:for-item="bean" wx:key="bean.id" value="{{bean.id}}" checked="{{bean.checked}}" data-room_type="{{bean.id}}">{{bean.name}}</radio>
            </radio-group>
          </view>
          <input class='display_hide' name="goods_img" value="{{my_activity_info.goods_img}}"> </input>
          <input class='display_hide' name="room_type" value="{{my_activity_info.room_type}}"></input>
          <input class='display_hide' name="start_time" value="{{my_activity_info.start_time}}"></input>
          <input class='display_hide' name="end_time" value="{{my_activity_info.end_time}}"></input>
          <input class='display_hide' name="goods_id" value="{{my_activity_info.goods_id}}"></input>
          <input class='display_hide' name="file_size" value="{{my_activity_info.file_size}}"></input>
          <input class="display_hide" name="duration" value="{{my_activity_info.duration}}"></input>
          <button class='btn-submit theme-button' form-type="submit">添加活动</button>
        </form>
      </view>
    </block>

    <!-- 我的活动[列表] -->
    <block wx:if="{{showPageType == 3}}">
      <block wx:if="{{is_my_activity == 0}}">
        <view class="row full_width theme7 touch-move-unactive" bindtap="addMyActivity">
          <view class="ads-mine full_width full_height flex_column_center">
            <view class="btn-ads-mine theme-button">添加我的活动</view>
          </view>
        </view>
      </block>
      <!-- <block wx:if="{{is_my_activity == 1}}">
        <view class="row full_width theme7 touch-move-unactive">
         
        </view>
      </block> -->
      <view class="row full_width theme7 touch-move-unactive" wx:for="{{sale_list}}" wx:for-item="bean" wx:key="key" data-index="{{index}}">
        <view class='content' wx:if="{{index==0 && is_my_activity==1}}">
          <view class="pic">
            <image class='photo full_height full_width' src='{{my_activity_info.img_url}}'></image>
            <view class="flag theme-font4 theme-background-9">我的</view>
            <image class='status' src='{{my_activity_info.check_status_img}}'></image>
          </view>
          <view class='goods'>
            <view class='title full_width theme-font2'>{{my_activity_info.goods_name}}</view>
            <view class='infomation full_width'>
              <view class='price theme-font2'>￥ {{my_activity_info.price}}元<!-- {{my_activity_info.start_time}}~{{my_activity_info.end_time}} {{my_activity_info.room_type_desc}}--></view>
            </view>
            <view class='operate'>
              <button class='btn-edit theme-button6' bindtap="editGoods">修改</button>
              <button disabled="{{box_btn}}" class='btn-menu' bindtap="programPlay" data-goods_id="{{my_activity_info.goods_id}}">节目单播放</button>
              <button disabled="{{box_btn}}" class='btn-tv' bindtap="boxShow" data-goods_id="{{my_activity_info.goods_id}}" data-oss_addr="{{my_activity_info.oss_addr}}" data-qrcode_url="{{my_activity_info.qrcode_url}}">电视播放</button>
            </view>
          </view>
        </view>
        <view class='content' wx:else>
          <view class="pic">
            <image src='{{bean.img_url}}'></image>
          </view>
          <view class='goods'>
            <view class='title full_width theme-font2'>{{bean.goods_name}}</view>
            <view class='infomation full_width'>
              <view class='price theme-font2'>￥ {{bean.price}}元</view>
              <!-- <view class='discount theme-font5'>返利 {{bean.rebate_integral}}积分</view> -->
            </view>
            <view class='operate'>
              <button disabled="{{box_btn}}" class='btn-tv' bindtap="boxShow" data-goods_id="{{my_activity_info.goods_id}}" data-oss_addr="{{my_activity_info.oss_addr}}" data-qrcode_url="{{my_activity_info.qrcode_url}}">电视播放</button>
            </view>
          </view>
        </view>
      </view>
    </block>
    <!-- <block wx:if="{{showPageType == 2 && is_my_activity==1 }}">
      <view class='ads-list theme7'>
        <view class='pic full_width'>
          <image class='status' src='{{my_activity_info.check_status_img}}'></image>
          <image class='photo full_height full_width' src='{{my_activity_info.img_url}}'></image>
        </view>
        <view class='row full_width'>
          <label class='theme-font3'>商品名称</label>
          <view class='theme-font2'>{{my_activity_info.goods_name}}</view>
        </view>
        <view class='row full_width'>
          <label class='theme-font3'>价格</label>
          <view class='theme-font2'>{{my_activity_info.price}}元</view>
        </view>
        <view class='row full_width' style="width: 550rpx;">
          <label class='theme-font3'>活动时间</label>
          <view class='theme-font2' style="width: 435rpx;height: 42rpx;">
            <label>{{my_activity_info.start_time}}</label>
            <label style="margin:0 10rpx;">~</label>
            <label>{{my_activity_info.end_time}}</label>
          </view>
        </view>
        <view class='row full_width'>
          <label class='theme-font3'>活动范围</label>
          <view class='theme-font2'>{{my_activity_info.room_type_desc}}</view>
        </view>
        <view class='row full_width'>
          <button class='btn-edit theme-button6' bindtap="editGoods">修改</button>
          <button disabled="{{box_btn}}" class='btn-menu theme-button' bindtap="programPlay" data-goods_id="{{my_activity_info.goods_id}}">节目单播放</button>
          <button disabled="{{box_btn}}" class='btn-tv theme-button' bindtap="boxShow" data-goods_id="{{my_activity_info.goods_id}}" data-oss_addr="{{my_activity_info.oss_addr}}" data-qrcode_url="{{my_activity_info.qrcode_url}}">电视播放</button>
        </view>
      </view>
    </block> -->

    <!-- 默认 -->
    <block wx:else>
    </block>

  </view>

</scroll-view>
<!-- 无机顶盒 -->
<view wx:else class="container theme-main" style="height:calc(100vh - {{28 + SystemInfo.statusBarHeight}}px);">
  <view class='sale-panel full_width full_height'>
    <!-- 活动促销 -->
    <block wx:if="{{showPageType == 1}}">
      <block wx:if="{{sale_list.length > 0}}">
        <view class="row full_width theme7 {{bean.isTouchMove ? 'touch-move-active' : 'touch-move-unactive'}}" wx:for="{{sale_list}}" wx:for-item="bean" wx:key="key" data-index="{{index}}" bindtouchstart="touchstart" bindtouchmove="touchmove">
          <view class='content' data-index="{{index}}">
            <image src='{{bean.img_url}}'></image>
            <view class='goods'>
              <view class='title full_width theme-font2'>{{bean.goods_name}}</view>
              <view class='infomation full_width'>
                <view class='price theme-font2'>￥ {{bean.price}}元</view>
              </view>
              <view class='operate'>
                <button class='share' bindtap="pop_share" data-goods_info="{{bean}}">分享</button>
              </view>
            </view>
          </view>
          <view class="del theme-button-add" catchtap="del" data-index="{{index}}">删除</view>
        </view>
      </block>
      <block wx:else>
        <view class="no-data full_width theme7">
          <view>您还没有选择要推广的活动</view>
          <view>请前往【我的——活动促销商品管理】选择</view>
          <view>
            <navigator class="theme-button-add" url="/pages/mine/pop_list">添加</navigator>
          </view>
        </view>
      </block>
    </block>
  </view>
</view>

<!-- 底部分享弹窗 -->
<bottom-modal show="{{showShareBottomPopWindow}}" width="100%" height='370rpx' background-color='unset' padding-bottom="calc(28px + {{SystemInfo.statusBarHeight}}px)" border-radius="0rpx" title-text='' confirm-text='' cancel-text='' bindclickMask='close_share'>
  <view class="share-bottom-pop-window">
    <view class="title">分享</view>
    <view class="btn-group">
      <button bindtap="recwsad" data-goods_info="{{goods_info}}">
        <image src="/images/icon/goods.png"></image>
        <view>推荐到好物圈</view>
      </button>
      <button open-type='share' data-goods_info="{{goods_info}}">
        <image src="/images/icon/wechart.png"></image>
        <view>分享好友</view>
      </button>
      <button bindtap="viewGoodsCode" data-goods_info="{{goods_info}}">
        <image src="/images/icon/friends_circle.png"></image>
        <view>生成商品码</view>
      </button>
    </view>
  </view>
  <view class="share-bottom-pop-window-cancel-btn" bindtap="close_share">取消</view>
</bottom-modal>

<!-- 底部商品码弹窗 -->
<bottom-modal show="{{showBottomPopGoodsCodeWindow}}" width="100%" height='500px' background-color='unset' padding-bottom="calc(28px + {{SystemInfo.statusBarHeight}}px)" border-radius="0rpx" title-text='' confirm-text='' cancel-text='' bindclickMask='closeViewGoodsCode'>
  <view class="bottom-pop-goods-code-window theme-font2 theme7">
    <view class="top-bar theme-font1">
      <view class="title">商品码</view>
      <view class="fa fa-close" bindtap="closeViewGoodsCode"></view>
    </view>
    <view class="detail">
      <canvas canvas-id="goodsCode" class="goods-code"></canvas>
    </view>
    <view class="btn-group">
      <!-- <button wx:if="{{hotel_has_room==1}}" class="launch theme-button-add" bindtap="viewRoomWin">大屏展示</button> -->
      <button class="save theme-button" bindtap='saveImageToPhotosAlbum'>保存到相册</button>
    </view>
    <view class="tip">保存图片到手机相册，将图片分享给您的好友~</view>
  </view>
</bottom-modal>

<!-- 选择投屏包间 -->
<modal show="{{showMiddlePopChoseBoxWindow}}" width="600rpx" height='400rpx' border-radius="0rpx" background-color='unset' title-text='' confirm-text='' cancel-text=''>
  <view class="middle-pop-chose-box-window theme-font2 theme7">
    <view class="title theme-font1">请选择投屏包间</view>
    <view class="main">
      <picker class="room-picker" bindchange="bindBoxPickerChange" value="{{box_index}}" range="{{box_name_list}}">
        <label>{{box_name_list[box_index]}}</label>
        <label class="fa fa-caret-down" aria-hidden="true"></label>
      </picker>
    </view>
    <view class="btn-group">
      <button bindtap="boxShow" class="theme-button" data-goods_id="{{goods_info.goods_id}}" data-oss_addr="{{goods_info.oss_addr}}" data-box_index="{{box_index}}">确定</button>
      <button class="theme-font4 theme8" bindtap="closeViewRoom">取消</button>
    </view>
  </view>
</modal>